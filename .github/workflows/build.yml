---
    name: build-ublue-hyprland
    on:
      pull_request:
        branches:
          - main
      schedule:
        - cron: '05 10 * * *'  # 10:05am UTC everyday
      push:
        branches:
          - main
          - develop
        paths-ignore:
          - '**/README.md'
      workflow_dispatch:
    
    jobs:
      build_push:
        uses: ./.github/workflows/build-push.yml
        with:
          image_name: "${{ github.event.repository.name }}"  # the name of the image produced by this build, matches repo names 
          image_desc: "Hyprland Shell Blue Image"
          image_registry: "ghcr.io/${{ github.repository_owner }}"  # do not edit
        permissions:
          contents: read
          packages: write
          id-token: write
    
      build_iso:
        uses: ./.github/workflows/build-iso.yml
        needs: build_push
              
      upload_iso_to_s3:
        name: Publish ISO Installer
        runs-on: ubuntu-latest
        needs: build_iso
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          S3_BUCKET: juniorfox-net-isos
          AWS_REGION: sa-east-1
          ISO_NAME: ${{ needs.build_iso.outputs.iso_name }}
          CHECKSUM: ${{ needs.build_iso.outputs.checksum }}
        
        steps:
          - name: Download ISO Artifact
            uses: actions/download-artifact@v4
            with:
              name: ${{ env.ISO_NAME}}
              path: ./iso-output
          
          - name: Upload ISO to S3
            id: upload
            run: |
              echo "uploading ${{ env.ISO_NAME }}"
              aws s3 cp "./iso-output/${{ env.ISO_NAME }}" "s3://${{ env.S3_BUCKET }}/${{ env.ISO_NAME }}"
              aws s3 cp "./iso-output/${{ env.CHECKSUM }}" "s3://${{ env.S3_BUCKET }}/${{ env.CHECKSUM }}"
          
          - name: Make ISO public
            id: make_public
            run : |
              aws s3api put-object-acl --bucket ${{ env.S3_BUCKET }} --key "${{ env.ISO_NAME }}" --acl public-read
              aws s3api put-object-acl --bucket ${{ env.S3_BUCKET }} --key "${{ env.CHECKSUM }}" --acl public-read
          
          - name: Output ISO url
            id: upload_iso_url
            run : |
              echo "https://${{ env.S3_BUCKET }}.s3.${{ env.AWS_REGION }}.amazonaws.com/${{ env.ISO_NAME }}"
              echo "https://${{ env.S3_BUCKET }}.s3.${{ env.AWS_REGION }}.amazonaws.com/${{ env.CHECKSUM }}"